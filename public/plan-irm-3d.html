<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Plan 3D Architecte â€” IRM Mobile T350 14' â€” Faucon PTR</title>
<style>
  *{margin:0;padding:0;box-sizing:border-box}
  body{background:#060608;color:#e5e5e5;font-family:'Segoe UI',system-ui,sans-serif;overflow:hidden;width:100vw;height:100vh}
  #c{position:fixed;top:0;left:0;width:100%;height:100%}
  #vig{position:fixed;top:0;left:0;right:0;bottom:0;pointer-events:none;z-index:50;box-shadow:inset 0 0 180px rgba(0,0,0,.55)}
  #ld{position:fixed;top:0;left:0;width:100%;height:100%;background:#060608;z-index:999;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:12px;transition:opacity .6s}
  #ld .sp{width:32px;height:32px;border:3px solid #222;border-top-color:#f59e0b;border-radius:50%;animation:spin .8s linear infinite}
  #ld p{font-size:12px;color:#525252}
  @keyframes spin{to{transform:rotate(360deg)}}
  .P{position:fixed;top:14px;left:14px;background:rgba(6,6,8,.92);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.06);border-radius:14px;padding:16px;width:245px;z-index:100;max-height:calc(100vh - 28px);overflow-y:auto;scrollbar-width:thin;scrollbar-color:#222 transparent}
  .P h1{font-size:16px;font-weight:700}.P h1 span{color:#f59e0b}
  .P .sub{font-size:9px;color:#404040;margin-bottom:12px;letter-spacing:.4px}
  .S{font-size:8px;text-transform:uppercase;letter-spacing:1.3px;color:#333;margin:12px 0 5px;font-weight:700}
  .vb{display:inline-block;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);border-radius:6px;color:#666;font-size:9.5px;padding:4px 9px;margin:2px;cursor:pointer;transition:all .15s;font-family:inherit}
  .vb:hover{border-color:#f59e0b;color:#f59e0b}.vb.on{background:rgba(245,158,11,.15);color:#f59e0b;border-color:rgba(245,158,11,.3);font-weight:600}
  .tr{display:flex;align-items:center;gap:6px;padding:2.5px 0}
  .tr input{accent-color:#f59e0b;cursor:pointer;width:13px;height:13px}
  .tr label{font-size:10.5px;color:#888;cursor:pointer}
  .dot{width:6px;height:6px;border-radius:2px;flex-shrink:0}
  .sg{display:grid;grid-template-columns:1fr 1fr;gap:2px;margin-top:3px}
  .si{font-size:8.5px;color:#444;padding:2px 0}.si strong{color:#888;display:block;font-size:9.5px}
  .lk{display:inline-block;margin-top:8px;font-size:9.5px;color:#f59e0b;text-decoration:none;opacity:.5;transition:opacity .2s}.lk:hover{opacity:1}
  .bb{position:fixed;bottom:14px;left:50%;transform:translateX(-50%);display:flex;gap:8px;z-index:100}
  .bb>div,.bb>button{background:rgba(6,6,8,.88);backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,.05);border-radius:8px;padding:5px 12px;font-size:9.5px;color:#555;font-family:inherit}
  .bb button{cursor:pointer;transition:all .15s;color:#888}.bb button:hover{border-color:#f59e0b;color:#f59e0b}
  .fs{position:fixed;top:14px;right:14px;background:rgba(6,6,8,.9);backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,.05);border-radius:8px;padding:6px 10px;color:#555;font-size:15px;cursor:pointer;z-index:100;transition:all .15s;line-height:1}.fs:hover{border-color:#f59e0b;color:#f59e0b}
  .l3{background:rgba(4,4,6,.88);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,.07);border-radius:5px;padding:3px 7px;font-size:9.5px;font-weight:600;white-space:nowrap;pointer-events:none;font-family:'Segoe UI',system-ui,sans-serif;line-height:1.35}
  .l3.c-i{color:#fbbf24;border-color:rgba(245,158,11,.2)}.l3.c-t{color:#c084fc;border-color:rgba(168,85,247,.2)}
  .l3.c-z{color:#f87171;border-color:rgba(239,68,68,.2)}.l3.c-e{color:#60a5fa;border-color:rgba(59,130,246,.2)}
  .l3.c-s{color:#34d399;border-color:rgba(16,185,129,.2)}.l3.c-d{color:rgba(245,158,11,.6);border-color:rgba(245,158,11,.1);font-weight:400;font-size:8.5px}
  .l3 .dm{font-size:7.5px;font-weight:400;opacity:.55;display:block}
  @media(max-width:640px){.P{width:190px;padding:10px}}
</style>
</head>
<body>

<div id="ld"><div class="sp"></div><p>Chargement de la scÃ¨ne 3D architecteâ€¦</p></div>
<div id="c"></div>
<div id="vig"></div>

<div class="P">
  <h1>FAUCON <span>PTR</span></h1>
  <div class="sub">IRM Mobile T350 14' â€” Visualisation architecte 3D</div>
  <div class="S">Vues</div>
  <div id="vb">
    <button class="vb on" data-v="hero">Perspective</button>
    <button class="vb" data-v="top">Dessus</button>
    <button class="vb" data-v="drv">Conducteur</button>
    <button class="vb" data-v="pas">Passager</button>
    <button class="vb" data-v="rear">ArriÃ¨re</button>
    <button class="vb" data-v="bore">DÃ©tail bore</button>
    <button class="vb" data-v="pat">Vue patient</button>
  </div>
  <div class="S">Rendu</div>
  <div class="tr"><input type="checkbox" id="t-real"><label for="t-real">Mode rÃ©aliste (couleurs IRM)</label></div>
  <div class="tr"><input type="checkbox" id="t-bloom" checked><label for="t-bloom">Bloom cinÃ©matique</label></div>
  <div class="S">Ã‰lÃ©ments</div>
  <div class="tr"><input type="checkbox" id="t-i" checked><div class="dot" style="background:#f59e0b"></div><label for="t-i">IRM (1.0Ã—0.82Ã—1.50m)</label></div>
  <div class="tr"><input type="checkbox" id="t-t" checked><div class="dot" style="background:#a855f7"></div><label for="t-t">Table patient (1.82Ã—0.75m)</label></div>
  <div class="tr"><input type="checkbox" id="t-z" checked><div class="dot" style="background:#ef4444"></div><label for="t-z">Zone dÃ©gagement 90Â°/1m</label></div>
  <div class="tr"><input type="checkbox" id="t-e" checked><div class="dot" style="background:#3b82f6"></div><label for="t-e">Armoire Ã©lectrique 30"Â³</label></div>
  <div class="tr"><input type="checkbox" id="t-s" checked><div class="dot" style="background:#10b981"></div><label for="t-s">Rangement</label></div>
  <div class="tr"><input type="checkbox" id="t-l" checked><label for="t-l">Labels</label></div>
  <div class="tr"><input type="checkbox" id="t-w" checked><label for="t-w">Parois</label></div>
  <div class="S">VÃ©hicule</div>
  <div class="sg">
    <div class="si"><strong>Long.</strong>4.00 m</div>
    <div class="si"><strong>Larg.</strong>2.045 m</div>
    <div class="si"><strong>Haut.</strong>1.98 m</div>
    <div class="si"><strong>DÃ©g.</strong>1.0m / 90Â°</div>
  </div>
  <a href="plan-irm.html" class="lk">â† Plan 2D technique</a>
</div>

<div class="bb">
  <div>Clic : rotation Â· Molette : zoom Â· Clic droit : pan</div>
  <button id="cap">ğŸ“· Capture HD</button>
</div>
<button class="fs" id="fs" title="Plein Ã©cran">â›¶</button>

<script type="importmap">{"imports":{"three":"https://cdn.jsdelivr.net/npm/three@0.163.0/build/three.module.js","three/addons/":"https://cdn.jsdelivr.net/npm/three@0.163.0/examples/jsm/"}}</script>
<script type="module">
import*as T from'three';
import{OrbitControls}from'three/addons/controls/OrbitControls.js';
import{CSS2DRenderer,CSS2DObject}from'three/addons/renderers/CSS2DRenderer.js';
import{RoomEnvironment}from'three/addons/environments/RoomEnvironment.js';
import{EffectComposer}from'three/addons/postprocessing/EffectComposer.js';
import{RenderPass}from'three/addons/postprocessing/RenderPass.js';
import{UnrealBloomPass}from'three/addons/postprocessing/UnrealBloomPass.js';
import{OutputPass}from'three/addons/postprocessing/OutputPass.js';
import{RoundedBoxGeometry}from'three/addons/geometries/RoundedBoxGeometry.js';

/* â”€â”€ Dimensions (meters) â”€â”€ */
const TK={L:4,W:2.045,H:1.98};
const IR={L:1,W:.82,H:1.5};
const TB={L:1.82,W:.75,TH:.05,EL:.75};
const CB={S:.762};
const ST={L:.6,W:.5,H:.8};

/* â”€â”€ Scene â”€â”€ */
const scene=new T.Scene();
scene.background=new T.Color(0x060608);
scene.fog=new T.FogExp2(0x060608,.025);

const cam=new T.PerspectiveCamera(38,innerWidth/innerHeight,.1,80);
const tgt=new T.Vector3(TK.W/2,TK.H*.32,TK.L/2);
const camStart=new T.Vector3(10,8,12);
const camEnd=new T.Vector3(4.2,2.6,5.8);
cam.position.copy(camStart);

/* â”€â”€ WebGL Renderer â”€â”€ */
const ren=new T.WebGLRenderer({antialias:true,preserveDrawingBuffer:true,powerPreference:'high-performance'});
ren.setSize(innerWidth,innerHeight);
ren.setPixelRatio(Math.min(devicePixelRatio,2));
ren.shadowMap.enabled=true;
ren.shadowMap.type=T.PCFSoftShadowMap;
ren.toneMapping=T.ACESFilmicToneMapping;
ren.toneMappingExposure=1.0;
document.getElementById('c').appendChild(ren.domElement);

/* â”€â”€ Environment (studio reflections) â”€â”€ */
const pmrem=new T.PMREMGenerator(ren);
const envMap=pmrem.fromScene(new RoomEnvironment(),.04).texture;
scene.environment=envMap;

/* â”€â”€ Post-processing â”€â”€ */
const composer=new EffectComposer(ren);
composer.addPass(new RenderPass(scene,cam));
const bloom=new UnrealBloomPass(new T.Vector2(innerWidth,innerHeight),.25,.6,.88);
composer.addPass(bloom);
composer.addPass(new OutputPass());

/* â”€â”€ CSS2D Renderer (labels) â”€â”€ */
const lr=new CSS2DRenderer();
lr.setSize(innerWidth,innerHeight);
lr.domElement.style.position='absolute';
lr.domElement.style.top='0';
lr.domElement.style.pointerEvents='none';
document.getElementById('c').appendChild(lr.domElement);

/* â”€â”€ Controls â”€â”€ */
const ctl=new OrbitControls(cam,ren.domElement);
ctl.target.copy(tgt);ctl.enableDamping=true;ctl.dampingFactor=.05;
ctl.minDistance=1;ctl.maxDistance=18;ctl.update();

/* â”€â”€ Lighting â”€â”€ */
scene.add(new T.AmbientLight(0x223,0.4));
const hemi=new T.HemisphereLight(0x8899bb,0x221100,.4);scene.add(hemi);

const sun=new T.DirectionalLight(0xfff6e8,2);
sun.position.set(5,9,3);sun.castShadow=true;
sun.shadow.mapSize.set(2048,2048);
sun.shadow.camera.left=-8;sun.shadow.camera.right=8;
sun.shadow.camera.top=8;sun.shadow.camera.bottom=-8;
sun.shadow.bias=-.0003;sun.shadow.normalBias=.02;
scene.add(sun);

// Soft fill lights
const fl1=new T.PointLight(0xffe8c0,.5,8);fl1.position.set(TK.W/2,TK.H-.05,TK.L/2);scene.add(fl1);
const fl2=new T.PointLight(0xc0d8ff,.3,6);fl2.position.set(TK.W/2,.4,TK.L-.3);scene.add(fl2);
const fl3=new T.PointLight(0xfff0dd,.2,4);fl3.position.set(.4,1,IR.L+.5);scene.add(fl3);

/* â”€â”€ Ground â”€â”€ */
const gnd=new T.Mesh(new T.PlaneGeometry(40,40),new T.MeshStandardMaterial({color:0x080808,roughness:.92,metalness:.05}));
gnd.rotation.x=-Math.PI/2;gnd.position.y=-.005;gnd.receiveShadow=true;scene.add(gnd);
scene.add(new T.GridHelper(40,80,0x111114,0x0c0c0e));

/* â”€â”€ Groups â”€â”€ */
const G={i:new T.Group,t:new T.Group,z:new T.Group,e:new T.Group,s:new T.Group,w:new T.Group,l:new T.Group};
Object.values(G).forEach(g=>scene.add(g));

/* â”€â”€ Material refs for color scheme toggle â”€â”€ */
const mats={};
const SCH={
  schema:{irm:0xd4860a,tbl:0x7c3aed,pad:0x6d28d9,cab:0x1d4ed8,sto:0x047857,bore:0x0a0a0a,ring:0xf59e0b},
  real:{irm:0xf0ebe4,tbl:0xb8b4ac,pad:0xd5d0c8,cab:0x3a3a3a,sto:0x4a4a4a,bore:0x111111,ring:0xcccccc}
};

/* â”€â”€ Helpers â”€â”€ */
function rbox(w,h,d,col,met=.5,rou=.3,cc=.6){
  const g=new RoundedBoxGeometry(w,h,d,4,.015);
  const m=new T.MeshPhysicalMaterial({color:col,metalness:met,roughness:rou,clearcoat:cc,clearcoatRoughness:.15,envMapIntensity:1.2});
  const mesh=new T.Mesh(g,m);mesh.castShadow=true;mesh.receiveShadow=true;
  const edge=new T.LineSegments(new T.EdgesGeometry(g,.5),new T.LineBasicMaterial({color:new T.Color(col).lerp(new T.Color(0xffffff),.25),transparent:true,opacity:.12}));
  mesh.add(edge);return{mesh,mat:m};
}
function lbl(txt,dim,cls){
  const d=document.createElement('div');d.className='l3 c-'+cls;
  d.innerHTML=txt+(dim?'<span class="dm">'+dim+'</span>':'');
  return new CSS2DObject(d);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* â”€â”€ TRUCK â”€â”€ */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const wallMat=new T.MeshPhysicalMaterial({color:0x889,transparent:true,opacity:.04,side:T.DoubleSide,depthWrite:false,roughness:.3,metalness:.1,clearcoat:.3});

// Floor (reflective dark surface â€” anti-static flooring)
const flr=new T.Mesh(new T.PlaneGeometry(TK.W,TK.L),new T.MeshPhysicalMaterial({color:0x151518,roughness:.25,metalness:.35,clearcoat:.8,clearcoatRoughness:.2,envMapIntensity:.8}));
flr.rotation.x=-Math.PI/2;flr.position.set(TK.W/2,.002,TK.L/2);flr.receiveShadow=true;G.w.add(flr);

// Ceiling
const ceil=new T.Mesh(new T.PlaneGeometry(TK.W,TK.L),wallMat.clone());
ceil.rotation.x=Math.PI/2;ceil.position.set(TK.W/2,TK.H,TK.L/2);G.w.add(ceil);

// Ceiling light strip
const cls2=new T.Mesh(new T.BoxGeometry(.08,.01,TK.L-.4),new T.MeshStandardMaterial({color:0xffffff,emissive:0xfff8ee,emissiveIntensity:.8}));
cls2.position.set(TK.W/2,TK.H-.005,TK.L/2);G.w.add(cls2);

// Walls
const sGeo=new T.PlaneGeometry(TK.L,TK.H);
[0,TK.W].forEach((x,i)=>{const w=new T.Mesh(sGeo.clone(),wallMat.clone());w.rotation.y=i?-Math.PI/2:Math.PI/2;w.position.set(x,TK.H/2,TK.L/2);G.w.add(w)});
const fGeo=new T.PlaneGeometry(TK.W,TK.H);
G.w.add(Object.assign(new T.Mesh(fGeo,wallMat.clone()),{position:new T.Vector3(TK.W/2,TK.H/2,0)}));

// Rear frame
const fm=new T.MeshPhysicalMaterial({color:0x404040,metalness:.7,roughness:.35,clearcoat:.5});
[.12,TK.W-.12].forEach(x=>{const p=new T.Mesh(new RoundedBoxGeometry(.06,TK.H,.06,2,.01),fm);p.position.set(x,TK.H/2,TK.L);p.castShadow=true;G.w.add(p)});
G.w.add(Object.assign(new T.Mesh(new RoundedBoxGeometry(TK.W-.16,.06,.06,2,.01),fm),{position:new T.Vector3(TK.W/2,TK.H-.03,TK.L)}));
G.w.add(Object.assign(new T.Mesh(new RoundedBoxGeometry(TK.W-.16,.06,.06,2,.01),fm),{position:new T.Vector3(TK.W/2,.03,TK.L)}));

// Wireframe
const bxE=new T.LineSegments(new T.EdgesGeometry(new T.BoxGeometry(TK.W,TK.H,TK.L)),new T.LineBasicMaterial({color:0x333338,transparent:true,opacity:.5}));
bxE.position.set(TK.W/2,TK.H/2,TK.L/2);G.w.add(bxE);

// Cab
const cabB=new T.Mesh(new RoundedBoxGeometry(TK.W+.2,1.5,1.4,3,.06),new T.MeshPhysicalMaterial({color:0x141416,roughness:.6,metalness:.5,clearcoat:.4}));
cabB.position.set(TK.W/2,.75,-.7);cabB.castShadow=true;G.w.add(cabB);
// Windshield
const ws=new T.Mesh(new T.PlaneGeometry(TK.W-.2,.5),new T.MeshPhysicalMaterial({color:0x4488bb,transparent:true,opacity:.25,metalness:.95,roughness:.05,clearcoat:1}));
ws.position.set(TK.W/2,1.1,-1.39);G.w.add(ws);

// Wheels
const wGeo=new T.CylinderGeometry(.3,.3,.2,24);
const wMat=new T.MeshPhysicalMaterial({color:0x0e0e0e,roughness:.85,metalness:.3});
[[-.15,.3,-.5],[TK.W+.15,.3,-.5],[-.15,.3,TK.L-.3],[TK.W+.15,.3,TK.L-.3]].forEach(p=>{
  const w=new T.Mesh(wGeo,wMat);w.rotation.z=Math.PI/2;w.position.set(...p);w.castShadow=true;G.w.add(w);
  // Hub cap
  const hc=new T.Mesh(new T.CircleGeometry(.18,16),new T.MeshPhysicalMaterial({color:0x333333,metalness:.9,roughness:.2}));
  hc.rotation.z=Math.PI/2;hc.position.set(p[0]+(p[0]<1?-.11:.11),p[1],p[2]);G.w.add(hc);
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* â”€â”€ IRM â”€â”€ */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const {mesh:irmM,mat:irmMat}=rbox(IR.W,IR.H,IR.L,SCH.schema.irm,.65,.15,.9);
irmM.position.set(IR.W/2,IR.H/2,IR.L/2);G.i.add(irmM);mats.irm=irmMat;

// Bore tunnel
const boreMat=new T.MeshPhysicalMaterial({color:SCH.schema.bore,side:T.BackSide,roughness:.95,metalness:.1});
const boreM=new T.Mesh(new T.CylinderGeometry(.27,.27,IR.L+.04,48,1,true),boreMat);
boreM.rotation.x=Math.PI/2;boreM.position.set(IR.W/2,IR.H/2,IR.L/2);G.i.add(boreM);mats.bore=boreMat;

// Bore ring (glowing)
const ringMat=new T.MeshPhysicalMaterial({color:SCH.schema.ring,emissive:SCH.schema.ring,emissiveIntensity:.6,metalness:.95,roughness:.05,clearcoat:1});
const ringM=new T.Mesh(new T.TorusGeometry(.27,.022,16,64),ringMat);
ringM.position.set(IR.W/2,IR.H/2,IR.L);G.i.add(ringM);mats.ring=ringMat;

// Glow halo
const glowMat=new T.MeshBasicMaterial({color:SCH.schema.ring,transparent:true,opacity:.06,side:T.DoubleSide});
const glowM=new T.Mesh(new T.TorusGeometry(.27,.08,8,64),glowMat);
glowM.position.copy(ringM.position);G.i.add(glowM);

// Console panel (integrated, on top)
const cpM=new T.Mesh(new RoundedBoxGeometry(.28,.015,.18,2,.005),new T.MeshPhysicalMaterial({color:0x111118,emissive:0x112233,emissiveIntensity:.4,metalness:.85,roughness:.15,clearcoat:1}));
cpM.position.set(IR.W/2,IR.H+.008,IR.L*.3);G.i.add(cpM);
// LED indicators
[-.08,0,.08].forEach((dx,idx)=>{
  const led=new T.Mesh(new T.SphereGeometry(.006,8,8),new T.MeshBasicMaterial({color:[0x22ff44,0x22ff44,0x4488ff][idx]}));
  led.position.set(IR.W/2+dx,IR.H+.02,IR.L*.3-.05);G.i.add(led);
});

G.l.add(Object.assign(lbl('IRM','1.0Ã—0.82Ã—1.50m â€” Console int.','i'),{position:new T.Vector3(IR.W/2,IR.H+.22,IR.L/2)}));

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* â”€â”€ TABLE PATIENT â”€â”€ */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const{mesh:tblM,mat:tblMat}=rbox(TB.W,TB.TH,TB.L,SCH.schema.tbl,.2,.5,.4);
tblM.position.set(IR.W/2,TB.EL,IR.L+TB.L/2);G.t.add(tblM);mats.tbl=tblMat;

// Padded surface
const padMat=new T.MeshPhysicalMaterial({color:SCH.schema.pad,roughness:.85,metalness:0,clearcoat:.1});
const padM=new T.Mesh(new RoundedBoxGeometry(TB.W-.06,.035,TB.L-.08,2,.01),padMat);
padM.position.set(IR.W/2,TB.EL+.042,IR.L+TB.L/2);G.t.add(padM);mats.pad=padMat;

// Legs
const legMat=new T.MeshPhysicalMaterial({color:0x555,metalness:.9,roughness:.15,clearcoat:.8});
const legGeo=new T.CylinderGeometry(.016,.016,TB.EL-TB.TH/2,12);
[[.3,.06],[.3,TB.L-.06],[-.3,.06],[-.3,TB.L-.06]].forEach(([dx,dz])=>{
  const l=new T.Mesh(legGeo,legMat);l.position.set(IR.W/2+dx,(TB.EL-TB.TH/2)/2,IR.L+dz);l.castShadow=true;G.t.add(l);
});

// Rails
const railGeo=new RoundedBoxGeometry(.025,.02,TB.L+.35,2,.005);
const railMat=new T.MeshPhysicalMaterial({color:0x888,metalness:.95,roughness:.1,clearcoat:1});
[-1,1].forEach(s=>{G.t.add(Object.assign(new T.Mesh(railGeo,railMat),{position:new T.Vector3(IR.W/2+s*(TB.W/2+.02),TB.EL-.025,IR.L+TB.L/2-.12)}))});

G.l.add(Object.assign(lbl('Table patient','1.82Ã—0.75m','t'),{position:new T.Vector3(IR.W/2,TB.EL+.35,IR.L+TB.L/2)}));

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* â”€â”€ 90Â° CLEARANCE ZONE â”€â”€ */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const cx=IR.W,cz=IR.L;
const clrMat=new T.MeshPhysicalMaterial({color:0xef4444,transparent:true,opacity:.04,side:T.DoubleSide,depthWrite:false});
const clrM=new T.Mesh(new T.CylinderGeometry(1,1,TK.H,64,1,false,0,Math.PI/2),clrMat);
clrM.position.set(cx,TK.H/2,cz);G.z.add(clrM);

// Floor arc
const ap=[];for(let i=0;i<=64;i++){const th=i/64*Math.PI/2;ap.push(cx+Math.sin(th),.008,cz+Math.cos(th))}
ap.push(cx,.008,cz,cx,.008,cz+1);
const arcL=new T.Line(new T.BufferGeometry().setAttribute('position',new T.Float32BufferAttribute(ap,3)),new T.LineDashedMaterial({color:0xef4444,dashSize:.05,gapSize:.035,transparent:true,opacity:.45}));
arcL.computeLineDistances();G.z.add(arcL);
const arcT=arcL.clone();arcT.position.y=TK.H-.015;arcT.computeLineDistances();G.z.add(arcT);

// Vertical pillars at arc
const vMat=new T.LineBasicMaterial({color:0xef4444,transparent:true,opacity:.08});
for(let i=0;i<=6;i++){const th=i/6*Math.PI/2;const vg=new T.BufferGeometry().setAttribute('position',new T.Float32BufferAttribute([cx+Math.sin(th),.005,cz+Math.cos(th),cx+Math.sin(th),TK.H-.005,cz+Math.cos(th)],3));G.z.add(new T.LineSegments(vg,vMat))}

G.l.add(Object.assign(lbl('Zone dÃ©gagement','90Â° â€” R: 1.0 m','z'),{position:new T.Vector3(cx+.5,.22,cz+.5)}));

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* â”€â”€ ARMOIRE Ã‰LECTRIQUE â”€â”€ */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const cabZ=2.91+CB.S/2;
const{mesh:cabMesh,mat:cabMat}=rbox(CB.S,CB.S,CB.S,SCH.schema.cab,.6,.25,.7);
cabMesh.position.set(CB.S/2,CB.S/2,cabZ);G.e.add(cabMesh);mats.cab=cabMat;
// Handle
const hdl=new T.Mesh(new RoundedBoxGeometry(.015,.1,.015,2,.003),new T.MeshPhysicalMaterial({color:0xaaa,metalness:.95,roughness:.1,clearcoat:1}));
hdl.position.set(CB.S-.01,CB.S/2,cabZ+CB.S/2+.015);G.e.add(hdl);

G.l.add(Object.assign(lbl('Armoire Ã©lec.','30" cube (0.762m)','e'),{position:new T.Vector3(CB.S/2,CB.S+.15,cabZ)}));

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* â”€â”€ RANGEMENT â”€â”€ */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const stZ=2.46+ST.L/2;
const{mesh:stoMesh,mat:stoMat}=rbox(ST.W,ST.H,ST.L,SCH.schema.sto,.35,.45,.5);
stoMesh.position.set(TK.W-ST.W/2,ST.H/2,stZ);G.s.add(stoMesh);mats.sto=stoMat;

G.l.add(Object.assign(lbl('Rangement','0.60Ã—0.50Ã—0.80m','s'),{position:new T.Vector3(TK.W-ST.W/2,ST.H+.15,stZ)}));

/* â”€â”€ Dimension labels â”€â”€ */
function dLine(a,b,col=0xf59e0b){const l=new T.Line(new T.BufferGeometry().setFromPoints([new T.Vector3(...a),new T.Vector3(...b)]),new T.LineDashedMaterial({color:col,dashSize:.05,gapSize:.04,transparent:true,opacity:.2}));l.computeLineDistances();return l}
G.l.add(dLine([TK.W+.25,.005,0],[TK.W+.25,.005,TK.L]));
G.l.add(Object.assign(lbl('4.00 m','','d'),{position:new T.Vector3(TK.W+.25,.005,TK.L/2)}));
G.l.add(dLine([0,.005,TK.L+.25],[TK.W,.005,TK.L+.25]));
G.l.add(Object.assign(lbl('2.045 m','','d'),{position:new T.Vector3(TK.W/2,.005,TK.L+.25)}));
G.l.add(dLine([TK.W+.25,0,0],[TK.W+.25,TK.H,0]));
G.l.add(Object.assign(lbl('1.98 m','','d'),{position:new T.Vector3(TK.W+.25,TK.H/2,0)}));

// Orientation
G.l.add(Object.assign(lbl('CABINE â—‚','','d'),{position:new T.Vector3(TK.W/2,TK.H/2,-.45)}));
G.l.add(Object.assign(lbl('â–¸ ARRIÃˆRE','','d'),{position:new T.Vector3(TK.W/2,TK.H/2,TK.L+.45)}));
G.l.add(Object.assign(lbl('CONDUCTEUR','','d'),{position:new T.Vector3(-.35,TK.H/2,TK.L/2)}));
G.l.add(Object.assign(lbl('PASSAGER','','d'),{position:new T.Vector3(TK.W+.35,TK.H/2,TK.L/2)}));

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* â”€â”€ ANIMATION â”€â”€ */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let ip=0,tp=null,tf=null,ta=0;
const ease=t=>1-Math.pow(1-t,3);

(function animate(){
  requestAnimationFrame(animate);
  if(ip<1){ip=Math.min(ip+.006,1);cam.position.lerpVectors(camStart,camEnd,ease(ip))}
  if(tp){ta=Math.min(ta+.015,1);cam.position.lerpVectors(tf,tp,ease(ta));if(ta>=1)tp=null}
  ctl.update();
  if(G.z.visible)clrMat.opacity=.03+Math.sin(Date.now()*.0015)*.02;
  if(G.i.visible){glowMat.opacity=.04+Math.sin(Date.now()*.0025)*.04;ringMat.emissiveIntensity=.4+Math.sin(Date.now()*.003)*.2}
  composer.render();
  lr.render(scene,cam);
})();

/* â”€â”€ Views â”€â”€ */
const V={
  hero:new T.Vector3(4.2,2.6,5.8),
  top:new T.Vector3(TK.W/2,7.5,TK.L/2+.01),
  drv:new T.Vector3(-3,1.5,TK.L/2),
  pas:new T.Vector3(TK.W+3,1.5,TK.L/2),
  rear:new T.Vector3(TK.W/2,1.4,TK.L+4),
  bore:new T.Vector3(IR.W/2+.3,IR.H/2+.15,IR.L+1.2),
  pat:new T.Vector3(TK.W/2+.6,1.1,TK.L+2.5)
};
document.querySelectorAll('.vb[data-v]').forEach(b=>b.addEventListener('click',()=>{
  document.querySelectorAll('.vb').forEach(x=>x.classList.remove('on'));b.classList.add('on');
  tf=cam.position.clone();tp=V[b.dataset.v].clone();ta=0;
}));

/* â”€â”€ Toggles â”€â”€ */
const TM={'t-i':'i','t-t':'t','t-z':'z','t-e':'e','t-s':'s','t-l':'l','t-w':'w'};
Object.entries(TM).forEach(([id,g])=>document.getElementById(id).addEventListener('change',e=>{G[g].visible=e.target.checked}));

/* â”€â”€ Bloom toggle â”€â”€ */
document.getElementById('t-bloom').addEventListener('change',e=>{bloom.strength=e.target.checked?.25:0});

/* â”€â”€ Realistic color toggle â”€â”€ */
document.getElementById('t-real').addEventListener('change',e=>{
  const s=e.target.checked?SCH.real:SCH.schema;
  mats.irm.color.set(s.irm);mats.tbl.color.set(s.tbl);mats.pad.color.set(s.pad);
  mats.cab.color.set(s.cab);mats.sto.color.set(s.sto);mats.bore.color.set(s.bore);
  mats.ring.color.set(s.ring);mats.ring.emissive.set(s.ring);
  glowMat.color.set(s.ring);
});

/* â”€â”€ Screenshot (3Ã— resolution) â”€â”€ */
document.getElementById('cap').addEventListener('click',()=>{
  const s=3,w=innerWidth*s,h=innerHeight*s;
  ren.setSize(w,h);ren.setPixelRatio(1);composer.setSize(w,h);
  composer.render();
  const a=document.createElement('a');a.download='plan-irm-3d-faucon-ptr.png';a.href=ren.domElement.toDataURL('image/png');a.click();
  ren.setSize(innerWidth,innerHeight);ren.setPixelRatio(Math.min(devicePixelRatio,2));composer.setSize(innerWidth,innerHeight);
});

/* â”€â”€ Fullscreen â”€â”€ */
document.getElementById('fs').addEventListener('click',()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()});

/* â”€â”€ Resize â”€â”€ */
addEventListener('resize',()=>{cam.aspect=innerWidth/innerHeight;cam.updateProjectionMatrix();ren.setSize(innerWidth,innerHeight);lr.setSize(innerWidth,innerHeight);composer.setSize(innerWidth,innerHeight)});

/* â”€â”€ Hide loader â”€â”€ */
const ld=document.getElementById('ld');ld.style.opacity='0';setTimeout(()=>ld.style.display='none',600);
</script>
</body>
</html>
